<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>New Tab</title>

    <link rel="stylesheet" href="./static/style.css">
    <!-- HTMX (optional, used for future actions like delete) -->
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>

</head>
<body>

<!-- Add link dialog -->
<dialog id="add-dialog">
    <button class="close-button">X</button>
    <p>Add New links</p>
    <form action="/add" method="POST" id="add-form">
        <label>
            <input type="text" name="name" placeholder="Name (Max 20 length)" required>
        </label>
        <label>
            <input type="url" name="url" placeholder="URL" required>
        </label>
        <label>
            <input type="url" name="favicon" placeholder="Custom favicon URL (optional)">
        </label>
        <button type="submit">Add</button>
    </form>
</dialog>

<!-- Edit link dialog -->
<dialog id="edit-dialog">
    <button class="close-button">X</button>
    <p>Edit Link</p>
    <form action="/edit" method="POST" id="edit-form">
        <input type="hidden" name="id" id="edit-id">
        <label>
            <input type="text" name="name" id="edit-name" placeholder="Name (Max 20 length)" required>
        </label>
        <label>
            <input type="url" name="url" id="edit-url" placeholder="URL" required>
        </label>
        <label>
            <input type="url" name="favicon" id="edit-favicon" placeholder="Custom favicon URL (optional)">
        </label>
        <button type="submit">Save</button>
    </form>
</dialog>

<div class="container">
    <ul id="links-list" class="links-list">
        {{ range .Links }}
        <li>
            <div class="link-info" onclick="window.location.href = '{{ .Href }}';">
                <div class="link-preview">
                    <img src="{{ .Img }}" alt="Preview" loading="lazy"/>
                </div>
                <div class="link-text">
                    <a href="{{ .Href }}" rel="noopener">
                        {{ .Name }}
                    </a>
                    <small style="color: var(--text-muted); display:block;">ID: {{ .ID }} • Position: {{ .Position
                        }}</small>
                </div>
            </div>
            <!-- Per-item action menu -->
            <div class="menu-container" onclick="event.stopPropagation();">
                <button class="item-menu-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Open actions">
                    ⋮
                </button>
                <div class="item-menu" role="menu">
                    <a role="menuitem" href="/move?id={{ .ID }}&dir=up" class="menu-item" data-action="move-up">Move left</a>
                    <a role="menuitem" href="/move?id={{ .ID }}&dir=down" class="menu-item" data-action="move-down">Move right</a>
                    <a role="menuitem" href="/edit?id={{ .ID }}" class="menu-item" data-action="edit"
                       data-id="{{ .ID }}"
                       data-name="{{ if .Name }}{{ .Name }}{{ end }}"
                       data-url="{{ .Href }}"
                       data-favicon="{{ if .Img }}{{ .Img }}{{ end }}"
                    >Edit</a>
                    <a role="menuitem" href="/delete?id={{ .ID }}" class="menu-item danger" data-action="delete">Delete</a>
                </div>
            </div>
        </li>
        {{ end }}
        <li>
            <div class="link-info" id="add-link">
                <div class="link-preview">
                    <img src="./static/plus.svg" alt="Placeholder">
                </div>
                <div class="link-text">
                    <a href="#">Add new link</a>
                </div>
            </div>
        </li>
        {{ if not .Links }}
        <li class="no-results">No links found.</li>
        {{ end }}
    </ul>

    <div class="search-box">
        <form action="https://www.google.com/search" method="GET" role="search" aria-label="Google search"
              autocomplete="off">
            <input
                    type="text"
                    id="search"
                    placeholder="Search Google"
                    name="q"
                    autofocus
            />
        </form>
    </div>
</div>

<script src="./static/script.js"></script>
</body>
</html>